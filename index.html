<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pretty Accesorios ‚ú®</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

    <style>
        /* --- ESTILOS --- */
        :root {
            --primary-color: #8A2BE2; --secondary-color: #DDA0DD;
            --bg-color: #F8F8FF; --text-color: #000000; --card-bg: #FFFFFF;
        }
        body { 
            background-color: var(--bg-color); color: var(--text-color); font-family: 'Montserrat', sans-serif;
            background-image: url('image_5.png'); background-repeat: repeat; background-size: 100px;
            position: relative; min-height: 100vh; overflow-x: hidden;
        }
        .bg-decoration { position: fixed; z-index: -1; opacity: 0.4; pointer-events: none; }
        h1, h2, h3, h5, .navbar-brand { font-family: 'Playfair Display', serif; }
        .navbar { background-color: rgba(255, 255, 255, 0.95); box-shadow: 0 4px 15px rgba(138, 43, 226, 0.1); border-bottom: 2px solid var(--secondary-color); }
        .navbar-brand { font-size: 1.5rem; color: var(--primary-color) !important; font-weight: 700; display: flex; align-items: center; }
        .nav-link { font-weight: 500; color: var(--text-color) !important; border-radius: 20px; transition: all 0.3s; padding: 0.5rem 1rem; margin: 0 0.2rem; }
        .nav-link:hover, .nav-link.active { color: white !important; background-color: var(--primary-color); font-weight: 700; }
        .nav-link-admin { color: var(--primary-color) !important; font-weight: 700; display: flex; align-items: center; }
        .nav-link-admin:hover { background-color: var(--secondary-color); color: var(--text-color) !important; }
        .card { background: var(--card-bg); border: 2px solid var(--secondary-color); border-radius: 15px; overflow: hidden; transition: transform 0.3s; }
        .card:hover { transform: translateY(-5px); border-color: var(--primary-color); box-shadow: 0 10px 20px rgba(138, 43, 226, 0.2); }
        .card-img-top { height: 280px; object-fit: cover; border-bottom: 3px solid var(--primary-color); cursor: pointer; transition: opacity 0.2s; }
        .card-img-top:hover { opacity: 0.9; }
        .price-tag { font-size: 1.4rem; font-family: 'Playfair Display', serif; color: var(--primary-color); font-weight: bold; }
        .whatsapp-btn { background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); color: white; border: none; border-radius: 25px; padding: 8px 20px; font-weight: 600; box-shadow: 0 4px 6px rgba(138, 43, 226, 0.3); transition: all 0.3s; }
        .whatsapp-btn:hover { background: linear-gradient(45deg, var(--secondary-color), var(--primary-color)); transform: scale(1.05); color: white; }
        .btn-primary-custom { background-color: var(--primary-color); border: none; font-weight: 700; color: white; }
        .btn-primary-custom:hover { background-color: var(--secondary-color); color: var(--text-color); }
        .btn-primary-custom:disabled { background-color: #ccc; cursor: not-allowed; }
        .admin-panel { border: 2px dashed var(--primary-color); background: rgba(255,255,255,0.95); padding: 25px; display: none; margin-bottom: 30px; border-radius: 15px; position: relative; z-index: 10; }
        .delete-btn { position: absolute; top: 10px; right: 10px; background: var(--primary-color); color: white; border: none; border-radius: 50%; width: 35px; height: 35px; z-index: 10; font-weight: bold; }
        #modalImage { max-height: 85vh; width: auto; max-width: 100%; object-fit: contain; border-radius: 8px; }
    </style>
</head>
<body>
    <img src="decor1.png" class="bg-decoration" style="top: -20px; left: -20px; width: 180px; transform: rotate(-15deg);">
    <img src="decor2.png" class="bg-decoration" style="top: 50px; right: -30px; width: 200px; transform: rotate(20deg);">
    <img src="decor3.png" class="bg-decoration" style="top: 180px; right: 10px; width: 110px; transform: rotate(-10deg);">
    <img src="decor4.png" class="bg-decoration" style="top: 35%; left: 10%; width: 100px; transform: rotate(45deg);">
    <img src="decor5.png" class="bg-decoration" style="bottom: 15%; right: 5%; width: 180px; transform: rotate(-10deg);">
    <img src="decor1.png" class="bg-decoration" style="bottom: -20px; right: -10px; width: 140px; transform: rotate(35deg);">

    <nav class="navbar navbar-expand-lg navbar-light sticky-top p-3">
        <div class="container">
            <a class="navbar-brand" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor" class="d-inline-block align-text-top me-2"><path d="M5 16L3 5L8.5 10L12 4L15.5 10L21 5L19 16H5M19 19C19 19.5523 18.5523 20 18 20H6C5.44772 20 5 19.5523 5 19V18H19V19Z" /></svg>
                Pretty Accesorios
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto" id="category-filters">
                    <li class="nav-item"><a class="nav-link active" href="#" onclick="filterProducts('todos')">Todo</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="filterProducts('pulseras')">Pulseras</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="filterProducts('collares')">Collares</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="filterProducts('anillos')">Anillos</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="filterProducts('tobilleras')">Tobilleras</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="filterProducts('cadenitas')">Cadenitas</a></li>
                    <li class="nav-item ms-3"><a class="nav-link nav-link-admin" href="#" onclick="toggleAdmin()">Soy la Due√±a</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <div id="admin-section" class="admin-panel rounded">
            <h3 class="mb-4" style="color: var(--primary-color);">üëë Panel de Carga</h3>
            <form id="product-form" class="row g-3">
                <div class="col-md-3"><label class="form-label fw-bold">Nombre</label><input type="text" class="form-control" id="nombre" required></div>
                <div class="col-md-2"><label class="form-label fw-bold">Precio ($)</label><input type="number" class="form-control" id="precio" required></div>
                <div class="col-md-3"><label class="form-label fw-bold">Categor√≠a</label><select id="categoria" class="form-select"><option value="pulseras">Pulsera</option><option value="collares">Collar</option><option value="anillos">Anillo</option><option value="tobilleras">Tobillera</option><option value="cadenitas">Cadenita</option></select></div>
                <div class="col-md-4">
                    <label class="form-label fw-bold">Foto del Producto</label>
                    <input type="file" class="form-control" id="foto-file" accept="image/*" required>
                </div>
                <div class="col-12"><label class="form-label fw-bold">Descripci√≥n</label><textarea class="form-control" id="descripcion" rows="2" required></textarea></div>
                <div class="col-12 text-end">
                    <button type="submit" id="submit-btn" class="btn btn-primary-custom px-4 py-2">‚ú® Subir Producto ‚ú®</button>
                    <div id="loading-msg" class="text-muted mt-2" style="display:none;">Subiendo foto... ‚è≥</div>
                </div>
            </form>
        </div>
        <div id="products-container" class="row row-cols-1 row-cols-md-3 g-4"></div>
    </div>

    <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content" style="background: transparent; border: none;">
                <div class="modal-body p-0 text-center position-relative">
                    <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3" data-bs-dismiss="modal" style="z-index: 10; background-color: rgba(0,0,0,0.5); padding: 0.5rem; border-radius: 50%;"></button>
                    <img src="" id="modalImage" class="img-fluid shadow-lg" alt="Imagen completa">
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, query, where } 
        from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ==========================================
        // üîë TU CLAVE DE IMGBB (YA CONFIGURADA)
        const IMGBB_API_KEY = "8a2b9037b8733cba6a00b87a07dad307"; 
        // ==========================================

        const firebaseConfig = {
            apiKey: "AIzaSyDqXsi6k9z4aDn46bYCEHylATvNak8ksMs",
            authDomain: "pretty-accesorios.firebaseapp.com",
            projectId: "pretty-accesorios",
            storageBucket: "pretty-accesorios.firebasestorage.app",
            messagingSenderId: "429462250492",
            appId: "1:429462250492:web:007bff7ee95a1e98efc879",
            measurementId: "G-4CY1K9C7GN"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const productsRef = collection(db, "productos");
        let isAdmin = false; let currentCategory = 'todos';

        // Funci√≥n para subir imagen a ImgBB
        async function uploadToImgBB(file) {
            const formData = new FormData();
            formData.append("image", file);
            formData.append("key", IMGBB_API_KEY);
            
            const response = await fetch("https://api.imgbb.com/1/upload", { method: "POST", body: formData });
            const data = await response.json();
            if(!data.success) throw new Error("Error ImgBB: " + (data.error ? data.error.message : "Desconocido"));
            return data.data.url; // Retorna el link directo
        }

        const renderProducts = (category = 'todos') => {
            const container = document.getElementById('products-container');
            container.innerHTML = '<div class="text-center w-100 fs-4" style="color: var(--primary-color);">Cargando cositas lindas... ‚è≥</div>';
            let q = productsRef;
            if(category !== 'todos') { q = query(productsRef, where("categoria", "==", category)); }

            onSnapshot(q, (snapshot) => {
                container.innerHTML = '';
                if(snapshot.empty) { container.innerHTML = '<div class="text-center w-100 mt-5"><h5 style="color: var(--text-color);">No hay productos aqu√≠ todav√≠a üò¢</h5></div>'; return; }
                snapshot.forEach((doc) => {
                    const prod = doc.data(); const id = doc.id;
                    const html = `
                        <div class="col">
                            <div class="card h-100 shadow-sm">
                                ${isAdmin ? `<button onclick="window.deleteProduct('${id}')" class="delete-btn" title="Borrar">X</button>` : ''}
                                <img src="${prod.imagen}" class="card-img-top" alt="${prod.nombre}" onclick="window.showFullImage('${prod.imagen}')" onerror="this.src='https://via.placeholder.com/300x280?text=Sin+Imagen'">
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title">${prod.nombre}</h5>
                                    <p class="card-text small" style="color: #666;">${prod.descripcion}</p>
                                    <div class="mt-auto d-flex justify-content-between align-items-center">
                                        <span class="price-tag">$${prod.precio}</span>
                                        <a href="https://wa.me/5492634670332?text=Hola!%20Quiero%20comprar%20el%20producto:%20${prod.nombre}" 
                                           class="btn whatsapp-btn btn-sm" target="_blank">¬°Lo quiero! üíú</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    container.innerHTML += html;
                });
            });
        };

        window.showFullImage = (imageUrl) => {
            document.getElementById('modalImage').src = imageUrl;
            bootstrap.Modal.getOrCreateInstance(document.getElementById('imageModal')).show();
        }

        document.getElementById('product-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = document.getElementById('submit-btn');
            const loadingMsg = document.getElementById('loading-msg');
            submitBtn.disabled = true; loadingMsg.style.display = 'block';

            const nombre = document.getElementById('nombre').value;
            const precio = Number(document.getElementById('precio').value);
            const categoria = document.getElementById('categoria').value;
            const descripcion = document.getElementById('descripcion').value;
            const fileInput = document.getElementById('foto-file');
            const file = fileInput.files[0];

            try {
                let imagenUrl = "";
                if (file) {
                    // Subimos a ImgBB
                    imagenUrl = await uploadToImgBB(file);
                } else {
                    throw new Error("Por favor selecciona una foto");
                }

                await addDoc(productsRef, { nombre, precio, categoria, imagen: imagenUrl, descripcion, fecha: new Date() });
                alert('¬°Producto subido con √©xito! üéâ'); e.target.reset();
            } catch (error) { console.error(error); alert("Error: " + error.message); } 
            finally { submitBtn.disabled = false; loadingMsg.style.display = 'none'; }
        });

        window.deleteProduct = async (id) => { if(confirm('¬øBorrar producto?')) { await deleteDoc(doc(db, "productos", id)); }}
        window.filterProducts = (cat) => {
            currentCategory = cat; renderProducts(cat);
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active')); event.target.classList.add('active'); 
        }
        window.toggleAdmin = () => {
            if(prompt("Ingresa la contrase√±a de la due√±a:") === "admin123") { 
                isAdmin = true; document.getElementById('admin-section').style.display = 'block'; renderProducts(currentCategory);
                alert("Modo Jefa activado üõ†Ô∏è");
            } else { alert("Contrase√±a incorrecta üö´"); }
        }
        renderProducts();
    </script>
</body>
</html>